<%# app/views/services/index.html.erb %>
<h1 class="page-title">Типы балок</h1>

<div class="toolbar">
  <%= form_with url: beams_path, method: :get, local: true do |f| %>
    <%= f.search_field :q, placeholder: "Поиск по названию, материалу…", class: "search-input" %>
    <%= f.submit "Найти", class: "btn btn--primary" %>
  <% end %>
</div>

<% if @beams.any? %>
  <div class="grid">
    <% @beams.each do |b| %>
      <div class="card card--grid">
        <div class="card__thumb-wrap">
          <%= image_url_for(b.image_key, alt: b.name, class: "card__thumb") %>
        </div>
        <div class="card__body">
          <h3 class="card__title"><%= b.name %></h3>
          <div class="card__meta">
            Материал: <%= b.material %> · E = <%= b.elasticity_gpa %> ГПа · I = <%= number_with_precision(b.inertia_cm4, precision: 1) %> см⁴ · Норма: L/<%= b.allowed_deflection_ratio %>
          </div>

          <div class="card__actions">
            <a href="<%= beam_path(b) %>" class="btn btn--secondary"><span>Подробнее</span></a>
            <%= form_with url: cart_items_path, method: :post, local: true do %>
              <%= hidden_field_tag :beam_id, b.id %>
              <%= hidden_field_tag :quantity, 1 %>
              <%= submit_tag "В заявку", class: "btn btn--primary" %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <p style="text-align:center; color:#6b7280; margin-top:16px">
    <% if params[:q].present? %>
      Ничего не найдено по запросу "<%= params[:q] %>".
    <% else %>
      Нет доступных услуг.
    <% end %>
  </p>
<% end %>

<%# Floating cart FAB (left-bottom). Keep server-only logic, no JS. %>
<% if @cart_available %>
  <%= link_to cart_path, class: "fab-cart", title: "Открыть заявку" do %>
    <%= image_tag "cart.png", alt: "", class: "fab-cart__icon" %>
    <span class="fab-cart__badge"><%= @cart_items_count %></span>
    <span class="sr-only">В заявке: <%= @cart_items_count %></span>
  <% end %>
<% else %>
  <button class="fab-cart is-disabled" title="Заявка отсутствует" disabled aria-disabled="true">
    <%= image_tag "cart.png", alt: "", class: "fab-cart__icon" %>
    <span class="fab-cart__badge">0</span>
    <span class="sr-only">Заявка отсутствует</span>
  </button>
<% end %>