# рџљЂ Р СѓРєРѕРІРѕРґСЃС‚РІРѕ РїРѕ СЂР°Р±РѕС‚Рµ СЃ Insomnia РґР»СЏ РґРµРјРѕРЅСЃС‚СЂР°С†РёРё

## рџ“Ґ Р§Р°СЃС‚СЊ 1: РРјРїРѕСЂС‚ РєРѕР»Р»РµРєС†РёРё

### РЁР°Рі 1: РћС‚РєСЂС‹С‚СЊ Insomnia

1. Р—Р°РїСѓСЃС‚РёС‚Рµ **Insomnia** (РёР»Рё **Postman**)
2. Р•СЃР»Рё СЌС‚Рѕ РїРµСЂРІС‹Р№ Р·Р°РїСѓСЃРє, СЃРѕР·РґР°Р№С‚Рµ РЅРѕРІС‹Р№ Workspace

### РЁР°Рі 2: РРјРїРѕСЂС‚РёСЂРѕРІР°С‚СЊ РєРѕР»Р»РµРєС†РёСЋ

#### Р’ Insomnia:

1. РќР°Р¶РјРёС‚Рµ **Application** в†’ **Preferences** (РёР»Рё Ctrl+,)
2. РџРµСЂРµР№РґРёС‚Рµ РЅР° РІРєР»Р°РґРєСѓ **Data**
3. РќР°Р¶РјРёС‚Рµ **Import Data** в†’ **From File**
4. Р’С‹Р±РµСЂРёС‚Рµ С„Р°Р№Р»: `C:\SHPP\Web\Insomnia_Collection.json`
5. РќР°Р¶РјРёС‚Рµ **Open**

**РР›Р** (Р±С‹СЃС‚СЂС‹Р№ СЃРїРѕСЃРѕР±):

1. РќР°Р¶РјРёС‚Рµ **Create** в†’ **Import**
2. Р’С‹Р±РµСЂРёС‚Рµ **From File**
3. РќР°Р№РґРёС‚Рµ Рё РІС‹Р±РµСЂРёС‚Рµ `Insomnia_Collection.json`
4. РќР°Р¶РјРёС‚Рµ **Scan** в†’ **Import**

#### Р’ Postman:

1. РќР°Р¶РјРёС‚Рµ **Import** (Р»РµРІС‹Р№ РІРµСЂС…РЅРёР№ СѓРіРѕР»)
2. Р’С‹Р±РµСЂРёС‚Рµ **Upload Files** РёР»Рё РїРµСЂРµС‚Р°С‰РёС‚Рµ С„Р°Р№Р»
3. Р’С‹Р±РµСЂРёС‚Рµ `Insomnia_Collection.json`
4. РќР°Р¶РјРёС‚Рµ **Import**

**Р РµР·СѓР»СЊС‚Р°С‚**: Р’С‹ СѓРІРёРґРёС‚Рµ РїР°РїРєСѓ СЃ 12 Р·Р°РїСЂРѕСЃР°РјРё

**рџ“ё РЎРєСЂРёРЅС€РѕС‚ РґР»СЏ РўР—**: РРјРїРѕСЂС‚РёСЂРѕРІР°РЅРЅР°СЏ РєРѕР»Р»РµРєС†РёСЏ РІ Insomnia

---

## рџЋЇ Р§Р°СЃС‚СЊ 2: РџРѕСЂСЏРґРѕРє РІС‹РїРѕР»РЅРµРЅРёСЏ Р·Р°РїСЂРѕСЃРѕРІ

### рџ“‹ РџРѕР»РЅС‹Р№ СЃРїРёСЃРѕРє Р·Р°РїСЂРѕСЃРѕРІ РІ РєРѕР»Р»РµРєС†РёРё:

```
1. Sign In (User)
2. Sign In (Moderator)
3. GET Requests (Guest) в†’ 401
4. GET Requests (User) в†’ Own Only
5. Complete Request (User) в†’ 403
6. Complete Request (Moderator) в†’ 200
7. GET Requests (Moderator) в†’ All
8. GET Drafts (Moderator) в†’ All Drafts вњЁ NEW
9. Sign Out (Blacklist Token)
10. GET with Blacklisted Token в†’ 401
EXTRA: GET Current User
EXTRA: GET Beams
```

---

## рџ”‘ Р§Р°СЃС‚СЊ 3: Р’С‹РїРѕР»РЅРµРЅРёРµ Р·Р°РїСЂРѕСЃРѕРІ РґР»СЏ РґРµРјРѕРЅСЃС‚СЂР°С†РёРё

### РЎС†РµРЅР°СЂРёР№ 1: РђСѓС‚РµРЅС‚РёС„РёРєР°С†РёСЏ Рё Р±Р°Р·РѕРІС‹Р№ РґРѕСЃС‚СѓРї

#### Р—Р°РїСЂРѕСЃ 3: GET Requests (Guest) в†’ 401

**Р¦РµР»СЊ**: РџРѕРєР°Р·Р°С‚СЊ, С‡С‚Рѕ Р±РµР· С‚РѕРєРµРЅР° РґРѕСЃС‚СѓРї Р·Р°РїСЂРµС‰РµРЅ

1. Р’С‹Р±РµСЂРёС‚Рµ Р·Р°РїСЂРѕСЃ **"3. GET Requests (Guest) в†’ 401"**
2. РџСЂРѕРІРµСЂСЊС‚Рµ URL: `http://localhost:3000/api/beam_deflections`
3. РџСЂРѕРІРµСЂСЊС‚Рµ Headers: РґРѕР»Р¶РЅРѕ Р±С‹С‚СЊ РїСѓСЃС‚Рѕ (РќР•Рў Authorization)
4. РќР°Р¶РјРёС‚Рµ **Send**

**РћР¶РёРґР°РµРјС‹Р№ СЂРµР·СѓР»СЊС‚Р°С‚**:
```
Status: 401 Unauthorized
Body: {
  "error": "Missing token" (РёР»Рё Р°РЅР°Р»РѕРіРёС‡РЅРѕРµ)
}
```

**рџ“ё РЎРєСЂРёРЅС€РѕС‚ #4 РґР»СЏ РўР—**: 401 Unauthorized РґР»СЏ РіРѕСЃС‚СЏ

**Р§С‚Рѕ РїРѕРєР°Р·Р°С‚СЊ**:
- вњ… URL РІ Р°РґСЂРµСЃРЅРѕР№ СЃС‚СЂРѕРєРµ
- вњ… HTTP РјРµС‚РѕРґ GET
- вњ… Status 401 РєСЂР°СЃРЅС‹Рј С†РІРµС‚РѕРј
- вњ… Response body СЃ РѕС€РёР±РєРѕР№
- вњ… РћС‚СЃСѓС‚СЃС‚РІРёРµ Authorization header

---

#### Р—Р°РїСЂРѕСЃ 1: Sign In (User)

**Р¦РµР»СЊ**: РџРѕР»СѓС‡РёС‚СЊ JWT С‚РѕРєРµРЅ РґР»СЏ РѕР±С‹С‡РЅРѕРіРѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ

1. Р’С‹Р±РµСЂРёС‚Рµ Р·Р°РїСЂРѕСЃ **"1. Sign In (User)"**
2. РџСЂРѕРІРµСЂСЊС‚Рµ URL: `http://localhost:3000/api/auth/sign_in`
3. РџРµСЂРµР№РґРёС‚Рµ РЅР° РІРєР»Р°РґРєСѓ **Body**
4. РЈР±РµРґРёС‚РµСЃСЊ С‡С‚Рѕ РІС‹Р±СЂР°РЅ **JSON**
5. РџСЂРѕРІРµСЂСЊС‚Рµ СЃРѕРґРµСЂР¶РёРјРѕРµ:
   ```json
   {
     "email": "user@demo.com",
     "password": "password123"
   }
   ```
6. РќР°Р¶РјРёС‚Рµ **Send**

**РћР¶РёРґР°РµРјС‹Р№ СЂРµР·СѓР»СЊС‚Р°С‚**:
```
Status: 200 OK
Body: {
  "token": "eyJhbGciOiJIUzI1NiJ9...",
  "user": {
    "id": 39,
    "email": "user@demo.com",
    "moderator": false
  }
}
```

**Р’РђР–РќРћ**: РЎРєРѕРїРёСЂСѓР№С‚Рµ Р·РЅР°С‡РµРЅРёРµ `token` РёР· Response!

**рџ“ё РЎРєСЂРёРЅС€РѕС‚ РґР»СЏ СЃРїСЂР°РІРєРё**: РЈСЃРїРµС€РЅР°СЏ Р°СѓС‚РµРЅС‚РёС„РёРєР°С†РёСЏ

**Р§С‚Рѕ РїРѕРєР°Р·Р°С‚СЊ**:
- вњ… Request body СЃ credentials
- вњ… Status 200 OK
- вњ… Response СЃ С‚РѕРєРµРЅРѕРј Рё РґР°РЅРЅС‹РјРё РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
- вњ… moderator: false

---

#### Р—Р°РїСЂРѕСЃ 4: GET Requests (User) в†’ Own Only

**Р¦РµР»СЊ**: РџРѕРєР°Р·Р°С‚СЊ, С‡С‚Рѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІРёРґРёС‚ С‚РѕР»СЊРєРѕ СЃРІРѕРё Р·Р°СЏРІРєРё

1. Р’С‹Р±РµСЂРёС‚Рµ Р·Р°РїСЂРѕСЃ **"4. GET Requests (User) в†’ Own Only"**
2. РџРµСЂРµР№РґРёС‚Рµ РЅР° РІРєР»Р°РґРєСѓ **Headers**
3. РџСЂРѕРІРµСЂСЊС‚Рµ Authorization header (С‚РѕРєРµРЅ СѓР¶Рµ РІСЃС‚СЂРѕРµРЅ):
   ```
   Authorization: Bearer eyJhbGciOiJIUzI1NiJ9...
   ```
4. **РћРџР¦РРћРќРђР›Р¬РќРћ**: Р—Р°РјРµРЅРёС‚Рµ С‚РѕРєРµРЅ РЅР° СЃРєРѕРїРёСЂРѕРІР°РЅРЅС‹Р№ РёР· Р·Р°РїСЂРѕСЃР° #1
5. РќР°Р¶РјРёС‚Рµ **Send**

**РћР¶РёРґР°РµРјС‹Р№ СЂРµР·СѓР»СЊС‚Р°С‚**:
```
Status: 200 OK
Body: {
  "beam_deflections": [
    {
      "id": 52,
      "status": "formed",
      "creator_login": "user@demo.com",
      ...
    },
    {
      "id": 53,
      "status": "completed",
      "creator_login": "user@demo.com",
      ...
    }
  ],
  "meta": {
    "total_count": 2
  }
}
```

**РћР±СЂР°С‚РёС‚Рµ РІРЅРёРјР°РЅРёРµ**:
- вњ… Р’СЃРµ Р·Р°СЏРІРєРё РїСЂРёРЅР°РґР»РµР¶Р°С‚ `user@demo.com`
- вњ… РќР• РІРєР»СЋС‡Р°РµС‚ РґСЂР°С„С‚С‹ (С‚РѕР»СЊРєРѕ formed/completed)
- вњ… total_count = 2 (РёР»Рё РґСЂСѓРіРѕРµ С‡РёСЃР»Рѕ)

**рџ“ё РЎРєСЂРёРЅС€РѕС‚ #5 РґР»СЏ РўР—**: РЎРїРёСЃРѕРє СЃРІРѕРёС… Р·Р°СЏРІРѕРє РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ

**Р§С‚Рѕ РїРѕРєР°Р·Р°С‚СЊ**:
- вњ… Authorization header СЃ С‚РѕРєРµРЅРѕРј
- вњ… Status 200 OK
- вњ… РЎРїРёСЃРѕРє Р·Р°СЏРІРѕРє С‚РѕР»СЊРєРѕ РѕС‚ user@demo.com
- вњ… РћС‚СЃСѓС‚СЃС‚РІРёРµ РґСЂР°С„С‚РѕРІ РІ СЃРїРёСЃРєРµ

---

### РЎС†РµРЅР°СЂРёР№ 2: РџРѕРїС‹С‚РєР° Р·Р°РІРµСЂС€РёС‚СЊ Р·Р°СЏРІРєСѓ РѕР±С‹С‡РЅС‹Рј РїРѕР»СЊР·РѕРІР°С‚РµР»РµРј

#### Р—Р°РїСЂРѕСЃ 5: Complete Request (User) в†’ 403

**Р¦РµР»СЊ**: РџРѕРєР°Р·Р°С‚СЊ, С‡С‚Рѕ РѕР±С‹С‡РЅС‹Р№ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РќР• РјРѕР¶РµС‚ Р·Р°РІРµСЂС€РёС‚СЊ Р·Р°СЏРІРєСѓ

1. Р’С‹Р±РµСЂРёС‚Рµ Р·Р°РїСЂРѕСЃ **"5. Complete Request (User) в†’ 403"**
2. РџСЂРѕРІРµСЂСЊС‚Рµ URL: `http://localhost:3000/api/beam_deflections/52/complete`
3. РџСЂРѕРІРµСЂСЊС‚Рµ РјРµС‚РѕРґ: **PUT**
4. РџСЂРѕРІРµСЂСЊС‚Рµ Headers: Authorization СЃ user token
5. РќР°Р¶РјРёС‚Рµ **Send**

**РћР¶РёРґР°РµРјС‹Р№ СЂРµР·СѓР»СЊС‚Р°С‚**:
```
Status: 403 Forbidden
Body: {
  "error": "Moderator access required"
}
```

**рџ“ё РЎРєСЂРёРЅС€РѕС‚ #6 РґР»СЏ РўР—**: 403 Forbidden РґР»СЏ РѕР±С‹С‡РЅРѕРіРѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ

**Р§С‚Рѕ РїРѕРєР°Р·Р°С‚СЊ**:
- вњ… URL СЃ /52/complete
- вњ… HTTP РјРµС‚РѕРґ PUT
- вњ… Authorization header (user token)
- вњ… Status 403 Forbidden
- вњ… Error message РїСЂРѕ moderator

---

### РЎС†РµРЅР°СЂРёР№ 3: РњРѕРґРµСЂР°С‚РѕСЂ Р·Р°РІРµСЂС€Р°РµС‚ Р·Р°СЏРІРєСѓ

#### Р—Р°РїСЂРѕСЃ 2: Sign In (Moderator)

**Р¦РµР»СЊ**: РџРѕР»СѓС‡РёС‚СЊ С‚РѕРєРµРЅ РјРѕРґРµСЂР°С‚РѕСЂР°

1. Р’С‹Р±РµСЂРёС‚Рµ Р·Р°РїСЂРѕСЃ **"2. Sign In (Moderator)"**
2. РџСЂРѕРІРµСЂСЊС‚Рµ Body:
   ```json
   {
     "email": "moderator@demo.com",
     "password": "password123"
   }
   ```
3. РќР°Р¶РјРёС‚Рµ **Send**

**РћР¶РёРґР°РµРјС‹Р№ СЂРµР·СѓР»СЊС‚Р°С‚**:
```
Status: 200 OK
Body: {
  "token": "eyJhbGciOiJIUzI1NiJ9...",
  "user": {
    "id": 40,
    "email": "moderator@demo.com",
    "moderator": true  в†ђ Р’РђР–РќРћ!
  }
}
```

**Р’РђР–РќРћ**: РЎРєРѕРїРёСЂСѓР№С‚Рµ С‚РѕРєРµРЅ РјРѕРґРµСЂР°С‚РѕСЂР°!

---

#### Р—Р°РїСЂРѕСЃ 6: Complete Request (Moderator) в†’ 200

**Р¦РµР»СЊ**: РџРѕРєР°Р·Р°С‚СЊ СѓСЃРїРµС€РЅРѕРµ Р·Р°РІРµСЂС€РµРЅРёРµ Р·Р°СЏРІРєРё РјРѕРґРµСЂР°С‚РѕСЂРѕРј

1. Р’С‹Р±РµСЂРёС‚Рµ Р·Р°РїСЂРѕСЃ **"6. Complete Request (Moderator) в†’ 200"**
2. РџСЂРѕРІРµСЂСЊС‚Рµ URL: `http://localhost:3000/api/beam_deflections/52/complete`
3. РџСЂРѕРІРµСЂСЊС‚Рµ Headers: Authorization СЃ moderator token
4. **Р’РђР–РќРћ**: РЈР±РµРґРёС‚РµСЃСЊ С‡С‚Рѕ ID=52 РµС‰С‘ РЅРµ Р·Р°РІРµСЂС€РµРЅР° (status: formed)
5. РќР°Р¶РјРёС‚Рµ **Send**

**РћР¶РёРґР°РµРјС‹Р№ СЂРµР·СѓР»СЊС‚Р°С‚**:
```
Status: 200 OK
Body: {
  "id": 52,
  "status": "completed",  в†ђ РёР·РјРµРЅРёР»СЃСЏ!
  "completed_at": "2025-01-29T...",  в†ђ Р·Р°РїРѕР»РЅРёР»СЃСЏ!
  "moderator_login": "moderator@demo.com",  в†ђ Р·Р°РїРѕР»РЅРёР»СЃСЏ!
  "result_deflection_mm": 2.5,  в†ђ СЂР°СЃСЃС‡РёС‚Р°Р»СЃСЏ!
  "within_norm": true,
  ...
}
```

**рџ“ё РЎРєСЂРёРЅС€РѕС‚ #7 РґР»СЏ РўР—**: РЈСЃРїРµС€РЅРѕРµ Р·Р°РІРµСЂС€РµРЅРёРµ Р·Р°СЏРІРєРё РјРѕРґРµСЂР°С‚РѕСЂРѕРј

**Р§С‚Рѕ РїРѕРєР°Р·Р°С‚СЊ**:
- вњ… URL СЃ /52/complete
- вњ… HTTP РјРµС‚РѕРґ PUT
- вњ… Authorization header (moderator token)
- вњ… Status 200 OK
- вњ… Response СЃ РѕР±РЅРѕРІР»РµРЅРЅС‹РјРё РїРѕР»СЏРјРё:
  - status: "completed"
  - completed_at: Р·Р°РїРѕР»РЅРµРЅ
  - moderator_login: "moderator@demo.com"
  - result_deflection_mm: С‡РёСЃР»Рѕ
  - within_norm: true/false

---

### РЎС†РµРЅР°СЂРёР№ 4: РњРѕРґРµСЂР°С‚РѕСЂ РІРёРґРёС‚ РІСЃРµ Р·Р°СЏРІРєРё

#### Р—Р°РїСЂРѕСЃ 7: GET Requests (Moderator) в†’ All

**Р¦РµР»СЊ**: РџРѕРєР°Р·Р°С‚СЊ, С‡С‚Рѕ РјРѕРґРµСЂР°С‚РѕСЂ РІРёРґРёС‚ Р’РЎР• Р·Р°СЏРІРєРё (РІРєР»СЋС‡Р°СЏ С‡СѓР¶РёРµ)

1. Р’С‹Р±РµСЂРёС‚Рµ Р·Р°РїСЂРѕСЃ **"7. GET Requests (Moderator) в†’ All"**
2. РџСЂРѕРІРµСЂСЊС‚Рµ Headers: Authorization СЃ moderator token
3. РќР°Р¶РјРёС‚Рµ **Send**

**РћР¶РёРґР°РµРјС‹Р№ СЂРµР·СѓР»СЊС‚Р°С‚**:
```
Status: 200 OK
Body: {
  "beam_deflections": [
    {
      "id": 52,
      "creator_login": "user@demo.com",  в†ђ С‡СѓР¶Р°СЏ Р·Р°СЏРІРєР°!
      "status": "completed",
      ...
    },
    {
      "id": 25,
      "creator_login": "demo@local",  в†ђ РµС‰С‘ С‡СѓР¶Р°СЏ!
      ...
    },
    ...
  ],
  "meta": {
    "total_count": 4  в†ђ Р±РѕР»СЊС€Рµ С‡РµРј Сѓ user!
  }
}
```

**РћР±СЂР°С‚РёС‚Рµ РІРЅРёРјР°РЅРёРµ**:
- вњ… Р—Р°СЏРІРєРё РѕС‚ Р РђР—РќР«РҐ РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№ (РЅРµ С‚РѕР»СЊРєРѕ moderator@demo.com)
- вњ… total_count Р±РѕР»СЊС€Рµ, С‡РµРј Р±С‹Р»Рѕ Сѓ РѕР±С‹С‡РЅРѕРіРѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
- вњ… РќР• РІРєР»СЋС‡Р°РµС‚ РґСЂР°С„С‚С‹ (С‚РѕР»СЊРєРѕ formed/completed/rejected)

**рџ“ё РЎРєСЂРёРЅС€РѕС‚ #8 РґР»СЏ РўР—**: РњРѕРґРµСЂР°С‚РѕСЂ РІРёРґРёС‚ РІСЃРµ Р·Р°СЏРІРєРё

**Р§С‚Рѕ РїРѕРєР°Р·Р°С‚СЊ**:
- вњ… Authorization header (moderator token)
- вњ… Status 200 OK
- вњ… Р—Р°СЏРІРєРё РѕС‚ Р РђР—РќР«РҐ creator_login
- вњ… total_count > 2

---

### РЎС†РµРЅР°СЂРёР№ 5: вњЁ РќРћР’РћР• - РњРѕРґРµСЂР°С‚РѕСЂ РІРёРґРёС‚ РІСЃРµ РґСЂР°С„С‚С‹

#### Р—Р°РїСЂРѕСЃ 8: GET Drafts (Moderator) в†’ All Drafts вњЁ NEW

**Р¦РµР»СЊ**: РџРѕРєР°Р·Р°С‚СЊ РќРћР’РЈР® С„СѓРЅРєС†РёРѕРЅР°Р»СЊРЅРѕСЃС‚СЊ - РїСЂРѕСЃРјРѕС‚СЂ РІСЃРµС… РґСЂР°С„С‚РѕРІ

1. Р’С‹Р±РµСЂРёС‚Рµ Р·Р°РїСЂРѕСЃ **"8. GET Drafts (Moderator) в†’ All Drafts вњЁ NEW"**
2. РџСЂРѕРІРµСЂСЊС‚Рµ URL: `http://localhost:3000/api/beam_deflections?status=draft`
3. РћР±СЂР°С‚РёС‚Рµ РІРЅРёРјР°РЅРёРµ РЅР° РїР°СЂР°РјРµС‚СЂ `?status=draft`
4. РџСЂРѕРІРµСЂСЊС‚Рµ Headers: Authorization СЃ moderator token
5. РќР°Р¶РјРёС‚Рµ **Send**

**РћР¶РёРґР°РµРјС‹Р№ СЂРµР·СѓР»СЊС‚Р°С‚**:
```
Status: 200 OK
Body: {
  "beam_deflections": [
    {
      "id": 23,
      "status": "draft",
      "creator_login": "dev@example.com",  в†ђ С‡СѓР¶РѕР№ РґСЂР°С„С‚!
      ...
    },
    {
      "id": 27,
      "status": "draft",
      "creator_login": "user1@test.com",  в†ђ РµС‰С‘ С‡СѓР¶РѕР№!
      ...
    },
    {
      "id": 28,
      "status": "draft",
      "creator_login": "user2@test.com",  в†ђ Рё РµС‰С‘!
      ...
    },
    {
      "id": 51,
      "status": "draft",
      "creator_login": "user@demo.com",  в†ђ Рё РѕС‚ demo user
      ...
    }
  ],
  "meta": {
    "total_count": 4
  }
}
```

**РћР±СЂР°С‚РёС‚Рµ РІРЅРёРјР°РЅРёРµ**:
- вњ… Р’РЎР• Р·Р°СЏРІРєРё СЃРѕ СЃС‚Р°С‚СѓСЃРѕРј "draft"
- вњ… РћС‚ Р РђР—РќР«РҐ РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№ (РЅРµ С‚РѕР»СЊРєРѕ РѕС‚ РјРѕРґРµСЂР°С‚РѕСЂР°)
- вњ… Р­С‚Рѕ РќРћР’РђРЇ С„СѓРЅРєС†РёРѕРЅР°Р»СЊРЅРѕСЃС‚СЊ!

**рџ“ё РЎРєСЂРёРЅС€РѕС‚ #9 РґР»СЏ РўР—**: вњЁ РњРѕРґРµСЂР°С‚РѕСЂ РІРёРґРёС‚ РІСЃРµ РґСЂР°С„С‚С‹ (РќРћР’РђРЇ Р¤РЈРќРљР¦РРЇ)

**Р§С‚Рѕ РїРѕРєР°Р·Р°С‚СЊ**:
- вњ… URL СЃ РїР°СЂР°РјРµС‚СЂРѕРј `?status=draft`
- вњ… Authorization header (moderator token)
- вњ… Status 200 OK
- вњ… Response СЃ РґСЂР°С„С‚Р°РјРё РѕС‚ Р РђР—РќР«РҐ РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№
- вњ… Р’РЎР• РёРјРµСЋС‚ status: "draft"
- вњ… РќР°РґРїРёСЃСЊ "вњЁ NEW" РІ РЅР°Р·РІР°РЅРёРё Р·Р°РїСЂРѕСЃР°

**Р’РђР–РќРћ**: Р­С‚Рѕ РєР»СЋС‡РµРІРѕР№ СЃРєСЂРёРЅС€РѕС‚ РґР»СЏ РґРµРјРѕРЅСЃС‚СЂР°С†РёРё РЅРѕРІРѕР№ С„СѓРЅРєС†РёРѕРЅР°Р»СЊРЅРѕСЃС‚Рё!

---

### РЎС†РµРЅР°СЂРёР№ 6: JWT Blacklist (Sign Out)

#### Р—Р°РїСЂРѕСЃ 9: Sign Out (Blacklist Token)

**Р¦РµР»СЊ**: РџРѕРєР°Р·Р°С‚СЊ РґРѕР±Р°РІР»РµРЅРёРµ С‚РѕРєРµРЅР° РІ blacklist

**РџРћР”Р“РћРўРћР’РљРђ**:
1. РСЃРїРѕР»СЊР·СѓР№С‚Рµ С‚РѕРєРµРЅ РѕР±С‹С‡РЅРѕРіРѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ (РёР· Р·Р°РїСЂРѕСЃР° #1)
2. РР»Рё СЃРѕР·РґР°Р№С‚Рµ РЅРѕРІС‹Р№ С‡РµСЂРµР· Р·Р°РїСЂРѕСЃ #1

**Р’С‹РїРѕР»РЅРµРЅРёРµ**:

1. Р’С‹Р±РµСЂРёС‚Рµ Р·Р°РїСЂРѕСЃ **"9. Sign Out (Blacklist Token)"**
2. РџРµСЂРµР№РґРёС‚Рµ РЅР° РІРєР»Р°РґРєСѓ **Headers**
3. **Р—РђРњР•РќРРўР•** `<REPLACE_WITH_TOKEN>` РЅР° Р°РєС‚СѓР°Р»СЊРЅС‹Р№ С‚РѕРєРµРЅ
   ```
   Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjozOSwiZXhwIjoxNzY0NTI5NTUwfQ...
   ```
4. РќР°Р¶РјРёС‚Рµ **Send**

**РћР¶РёРґР°РµРјС‹Р№ СЂРµР·СѓР»СЊС‚Р°С‚**:
```
Status: 204 No Content
Body: (РїСѓСЃС‚Рѕ)
```

**РџСЂРѕРІРµСЂРєР° РІ CMD**:
РћС‚РєСЂРѕР№С‚Рµ РєРѕРјР°РЅРґРЅСѓСЋ СЃС‚СЂРѕРєСѓ Рё РІС‹РїРѕР»РЅРёС‚Рµ:
```bash
docker-compose exec redis redis-cli KEYS "jwt:blacklist:*"
```

Р”РѕР»Р¶РµРЅ РїРѕСЏРІРёС‚СЊСЃСЏ **РЅРѕРІС‹Р№ РєР»СЋС‡**!

**рџ“ё РЎРєСЂРёРЅС€РѕС‚ #13 РґР»СЏ РўР—**: РќРѕРІС‹Р№ blacklist РєР»СЋС‡ РїРѕСЃР»Рµ sign_out

---

#### Р—Р°РїСЂРѕСЃ 10: GET with Blacklisted Token в†’ 401

**Р¦РµР»СЊ**: РџРѕРєР°Р·Р°С‚СЊ, С‡С‚Рѕ blacklisted С‚РѕРєРµРЅ РЅРµ СЂР°Р±РѕС‚Р°РµС‚

1. Р’С‹Р±РµСЂРёС‚Рµ Р·Р°РїСЂРѕСЃ **"10. GET with Blacklisted Token в†’ 401"**
2. **Р—РђРњР•РќРРўР•** `<REPLACE_WITH_BLACKLISTED_TOKEN>` РЅР° С‚РѕРєРµРЅ РёР· С€Р°РіР° #9
3. РќР°Р¶РјРёС‚Рµ **Send**

**РћР¶РёРґР°РµРјС‹Р№ СЂРµР·СѓР»СЊС‚Р°С‚**:
```
Status: 401 Unauthorized
Body: {
  "error": "Token has been revoked" (РёР»Рё Р°РЅР°Р»РѕРіРёС‡РЅРѕРµ)
}
```

**рџ“ё РЎРєСЂРёРЅС€РѕС‚ #14 РґР»СЏ РўР—**: 401 РґР»СЏ blacklisted С‚РѕРєРµРЅР°

**Р§С‚Рѕ РїРѕРєР°Р·Р°С‚СЊ**:
- вњ… Authorization header СЃ blacklisted С‚РѕРєРµРЅРѕРј
- вњ… Status 401 Unauthorized
- вњ… Error message РїСЂРѕ revoked token

---

## рџ“ё Р§Р°СЃС‚СЊ 4: РЎРєСЂРёРЅС€РѕС‚С‹ РґР»СЏ РўР— (РёР· Insomnia)

### РЎРїРёСЃРѕРє СЃРєСЂРёРЅС€РѕС‚РѕРІ РёР· Insomnia:

| # | РќР°Р·РІР°РЅРёРµ | Р—Р°РїСЂРѕСЃ | Р§С‚Рѕ РїРѕРєР°Р·Р°С‚СЊ |
|---|----------|--------|--------------|
| 4 | 401 РґР»СЏ РіРѕСЃС‚СЏ | #3 | GET Р±РµР· С‚РѕРєРµРЅР° в†’ 401 |
| 5 | РЎРІРѕРё Р·Р°СЏРІРєРё | #4 | GET СЃ user в†’ С‚РѕР»СЊРєРѕ СЃРІРѕРё |
| 6 | 403 РґР»СЏ user | #5 | PUT complete в†’ 403 |
| 7 | 200 РґР»СЏ moderator | #6 | PUT complete в†’ 200 вњ… |
| 8 | Р’СЃРµ Р·Р°СЏРІРєРё (mod) | #7 | GET в†’ РІСЃРµ Р·Р°СЏРІРєРё |
| 9 | вњЁ Р’СЃРµ РґСЂР°С„С‚С‹ (mod) | #8 | GET ?status=draft в†’ РґСЂР°С„С‚С‹ |
| 13 | РќРѕРІС‹Р№ blacklist | #9 | РџРѕСЃР»Рµ sign_out |
| 14 | 401 РґР»СЏ blacklisted | #10 | GET СЃ revoked token |

---

## рџЋЇ Р§Р°СЃС‚СЊ 5: РЎРѕРІРµС‚С‹ РїРѕ РґРµРјРѕРЅСЃС‚СЂР°С†РёРё

### РџРѕРґРіРѕС‚РѕРІРєР°

1. **РџРµСЂРµРґ РґРµРјРѕРЅСЃС‚СЂР°С†РёРµР№**:
   - РџСЂРѕРІРµСЂСЊС‚Рµ, С‡С‚Рѕ СЃРµСЂРІРёСЃС‹ Р·Р°РїСѓС‰РµРЅС‹: `docker-compose ps`
   - РџРµСЂРµСЃРѕР·РґР°Р№С‚Рµ РґР°РЅРЅС‹Рµ: `docker-compose exec web bin/rails runner utilities/scripts/prepare_demo.rb`
   - РџСЂРѕРІРµСЂСЊС‚Рµ РіРѕС‚РѕРІРЅРѕСЃС‚СЊ: `docker-compose exec web bin/rails runner utilities/scripts/verify_demo.rb`

2. **РћС‚РєСЂРѕР№С‚Рµ Р·Р°СЂР°РЅРµРµ**:
   - Insomnia СЃ РёРјРїРѕСЂС‚РёСЂРѕРІР°РЅРЅРѕР№ РєРѕР»Р»РµРєС†РёРµР№
   - РљРѕРјР°РЅРґРЅСѓСЋ СЃС‚СЂРѕРєСѓ РґР»СЏ Redis
   - Swagger UI (http://localhost:3000/api-docs)

3. **РџСЂРѕРІРµСЂСЊС‚Рµ ID Р·Р°СЏРІРѕРє**:
   ```bash
   docker-compose exec web bin/rails runner "puts BeamDeflection.formed.first.id"
   ```
   Р•СЃР»Рё ID РЅРµ 52, Р·Р°РјРµРЅРёС‚Рµ РІ Р·Р°РїСЂРѕСЃР°С… #5 Рё #6

### Р’Рѕ РІСЂРµРјСЏ РґРµРјРѕРЅСЃС‚СЂР°С†РёРё

1. **РџРѕРєР°Р·С‹РІР°Р№С‚Рµ РїРѕСЃР»РµРґРѕРІР°С‚РµР»СЊРЅРѕ**:
   - РЎРЅР°С‡Р°Р»Р° РіРѕСЃС‚СЊ (401)
   - РџРѕС‚РѕРј user (СЃРІРѕРё Р·Р°СЏРІРєРё)
   - РџРѕС‚РѕРј user РїС‹С‚Р°РµС‚СЃСЏ complete (403)
   - РџРѕС‚РѕРј moderator complete (200)
   - РџРѕС‚РѕРј moderator РІРёРґРёС‚ РІСЃРµ
   - вњЁ **РќРћР’РћР•**: moderator РІРёРґРёС‚ РґСЂР°С„С‚С‹

2. **РљРѕРјРјРµРЅС‚РёСЂСѓР№С‚Рµ**:
   - "РћР±С‹С‡РЅС‹Р№ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІРёРґРёС‚ С‚РѕР»СЊРєРѕ СЃРІРѕРё Р·Р°СЏРІРєРё"
   - "РњРѕРґРµСЂР°С‚РѕСЂ РјРѕР¶РµС‚ Р·Р°РІРµСЂС€РёС‚СЊ Р·Р°СЏРІРєСѓ"
   - вњЁ "**РќРѕРІР°СЏ С„СѓРЅРєС†РёСЏ**: РњРѕРґРµСЂР°С‚РѕСЂ РјРѕР¶РµС‚ РїСЂРѕСЃРјРѕС‚СЂРµС‚СЊ Р’РЎР• РґСЂР°С„С‚С‹ РѕС‚ РІСЃРµС… РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№"

3. **РџРѕРєР°Р·С‹РІР°Р№С‚Рµ Response**:
   - Status code (С†РІРµС‚РЅРѕР№ РёРЅРґРёРєР°С‚РѕСЂ)
   - Response body (СЂР°Р·РІРµСЂРЅРёС‚Рµ РЅСѓР¶РЅС‹Рµ РїРѕР»СЏ)
   - Headers (РѕСЃРѕР±РµРЅРЅРѕ Authorization)

### РџРѕСЃР»Рµ РґРµРјРѕРЅСЃС‚СЂР°С†РёРё

1. **РћС‡РёСЃС‚РєР°** (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ):
   ```bash
   docker-compose exec web bin/rails runner utilities/scripts/prepare_demo.rb
   ```

2. **РЎР±СЂРѕСЃ Redis** (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ):
   ```bash
   docker-compose exec redis redis-cli FLUSHDB
   ```

---

## рџ”§ Р§Р°СЃС‚СЊ 6: Troubleshooting

### РџСЂРѕР±Р»РµРјР°: 401 РґР»СЏ РІСЃРµС… Р·Р°РїСЂРѕСЃРѕРІ

**Р РµС€РµРЅРёРµ**:
1. РџСЂРѕРІРµСЂСЊС‚Рµ, С‡С‚Рѕ С‚РѕРєРµРЅС‹ Р°РєС‚СѓР°Р»СЊРЅС‹
2. Р’С‹РїРѕР»РЅРёС‚Рµ Р·Р°РїСЂРѕСЃ #1 РёР»Рё #2 РґР»СЏ РїРѕР»СѓС‡РµРЅРёСЏ РЅРѕРІРѕРіРѕ С‚РѕРєРµРЅР°
3. Р—Р°РјРµРЅРёС‚Рµ С‚РѕРєРµРЅ РІ Headers

### РџСЂРѕР±Р»РµРјР°: 404 Not Found РґР»СЏ ID=52

**Р РµС€РµРЅРёРµ**:
1. РџСЂРѕРІРµСЂСЊС‚Рµ Р°РєС‚СѓР°Р»СЊРЅС‹Р№ ID:
   ```bash
   docker-compose exec web bin/rails runner "puts BeamDeflection.formed.first.id"
   ```
2. Р—Р°РјРµРЅРёС‚Рµ ID РІ URL Р·Р°РїСЂРѕСЃРѕРІ #5 Рё #6

### РџСЂРѕР±Р»РµРјР°: РџСѓСЃС‚РѕР№ СЃРїРёСЃРѕРє РґСЂР°С„С‚РѕРІ (Р·Р°РїСЂРѕСЃ #8)

**Р РµС€РµРЅРёРµ**:
1. РџРµСЂРµСЃРѕР·РґР°Р№С‚Рµ РґР°РЅРЅС‹Рµ:
   ```bash
   docker-compose exec web bin/rails runner utilities/scripts/prepare_demo.rb
   ```
2. РџСЂРѕРІРµСЂСЊС‚Рµ РєРѕР»РёС‡РµСЃС‚РІРѕ:
   ```bash
   docker-compose exec web bin/rails runner "puts BeamDeflection.draft.count"
   ```

### РџСЂРѕР±Р»РµРјР°: РќРµ РІРёРґРЅРѕ РЅРѕРІС‹С… blacklist РєР»СЋС‡РµР№

**Р РµС€РµРЅРёРµ**:
1. РџСЂРѕРІРµСЂСЊС‚Рµ Redis:
   ```bash
   docker-compose exec redis redis-cli PING
   ```
2. РџСЂРѕРІРµСЂСЊС‚Рµ РєР»СЋС‡Рё:
   ```bash
   docker-compose exec redis redis-cli KEYS "*"
   ```

---

## рџ“‹ Р§Р°СЃС‚СЊ 7: РљСЂР°С‚РєРёР№ С‡РµРєР»РёСЃС‚

- [ ] РРјРїРѕСЂС‚РёСЂРѕРІР°С‚СЊ `Insomnia_Collection.json`
- [ ] РџСЂРѕРІРµСЂРёС‚СЊ, С‡С‚Рѕ СЃРµСЂРІРёСЃС‹ Р·Р°РїСѓС‰РµРЅС‹
- [ ] Р—Р°РїСЂРѕСЃ #3: GET Р±РµР· С‚РѕРєРµРЅР° в†’ 401 рџ“ё
- [ ] Р—Р°РїСЂРѕСЃ #1: Sign in (user)
- [ ] Р—Р°РїСЂРѕСЃ #4: GET СЃ user в†’ СЃРІРѕРё Р·Р°СЏРІРєРё рџ“ё
- [ ] Р—Р°РїСЂРѕСЃ #5: Complete СЃ user в†’ 403 рџ“ё
- [ ] Р—Р°РїСЂРѕСЃ #2: Sign in (moderator)
- [ ] Р—Р°РїСЂРѕСЃ #6: Complete СЃ moderator в†’ 200 рџ“ё
- [ ] Р—Р°РїСЂРѕСЃ #7: GET РІСЃРµ Р·Р°СЏРІРєРё (moderator) рџ“ё
- [ ] Р—Р°РїСЂРѕСЃ #8: вњЁ GET РґСЂР°С„С‚С‹ (moderator) в†’ РќРћР’РћР• рџ“ё
- [ ] Р—Р°РїСЂРѕСЃ #9: Sign out (РїРѕР»СѓС‡РёС‚СЊ РЅРѕРІС‹Р№ С‚РѕРєРµРЅ СЃРЅР°С‡Р°Р»Р°)
- [ ] РџСЂРѕРІРµСЂРёС‚СЊ Redis blacklist рџ“ё
- [ ] Р—Р°РїСЂРѕСЃ #10: GET СЃ blacklisted в†’ 401 рџ“ё

---

## рџЋ‰ Р“РѕС‚РѕРІРѕ!

РўРµРїРµСЂСЊ Сѓ РІР°СЃ РµСЃС‚СЊ РїРѕР»РЅРѕРµ СЂСѓРєРѕРІРѕРґСЃС‚РІРѕ РїРѕ СЂР°Р±РѕС‚Рµ СЃ Insomnia РґР»СЏ РґРµРјРѕРЅСЃС‚СЂР°С†РёРё РїСЂРѕРµРєС‚Р°.

**РљР»СЋС‡РµРІС‹Рµ РјРѕРјРµРЅС‚С‹**:
- вњ… 12 РіРѕС‚РѕРІС‹С… Р·Р°РїСЂРѕСЃРѕРІ
- вњ… РўРѕРєРµРЅС‹ СѓР¶Рµ РІСЃС‚СЂРѕРµРЅС‹
- вњ… РџРѕСЃР»РµРґРѕРІР°С‚РµР»СЊРЅРѕСЃС‚СЊ РІС‹РїРѕР»РЅРµРЅРёСЏ СЏСЃРЅР°
- вњЁ **РќРѕРІР°СЏ С„СѓРЅРєС†РёСЏ** (#8) РІС‹РґРµР»РµРЅР°
- рџ“ё 8 СЃРєСЂРёРЅС€РѕС‚РѕРІ РёР· Insomnia РґР»СЏ РўР—

РЈРґР°С‡РЅРѕР№ РґРµРјРѕРЅСЃС‚СЂР°С†РёРё! рџљЂ

